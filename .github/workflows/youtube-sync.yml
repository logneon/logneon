name: LOGNEON YouTube Content Sync
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */4 * * *'

permissions:
  contents: write

jobs:
  sync-youtube-content:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Create directories
      run: |
        mkdir -p data
        ls -la
        
    - name: Install dependencies
      run: |
        npm init -y
        npm install axios
        
    - name: Test environment
      run: |
        echo "Testing API key: ${YOUTUBE_API_KEY:0:10}..."
        echo "Testing Channel ID: ${CHANNEL_ID:0:10}..."
      env:
        YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        CHANNEL_ID: ${{ secrets.LOGNEON_CHANNEL_ID }}
        
    - name: Fetch YouTube data
      env:
        YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        CHANNEL_ID: ${{ secrets.LOGNEON_CHANNEL_ID }}
      run: |
        node fetch-youtube.js
        ls -la data/
        
    - name: Commit changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        if ! git diff --staged --quiet; then
          git commit -m "ðŸ”¥ Update LOGNEON content $(date)"
          git push
        else
          echo "No changes to commit"
        fi
